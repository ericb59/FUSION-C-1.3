/*
 ___________________________________________________________
/               __           _                              \
|              / _|         (_)                             |
|             | |_ _   _ ___ _  ___  _ __                   |
|             |  _| | | / __| |/ _ \| '_ \                  |
|             | | | |_| \__ \ | (_) | | | |                 |
|             |_|  \__,_|___/_|\___/|_| |_| *               |
|                                                           |
|               The MSX C Library for SDCC                  |
|                 E X A M P L E  C O D E                    |
|                                            FUSION-C v1.3  |
\___________________________________________________________/
*/
// Sprite Follow a Path
// Path data are generated by the Tool SPRITE PATH EDITOR (Included in Fusion-C v1.3)
//
// Works on MSX1 and Upper 
//
#include "fusion-c/header/msx_fusion.h"
#include "fusion-c/header/vdp_sprites.h"

typedef struct {
    unsigned char y; 			// important Keep this order
    unsigned char x;
    unsigned char Data;
    // ... you can add other variables from here
} DEF_SPRITE;

static DEF_SPRITE sprite1; 
static DEF_SPRITE sprite2; 

// Path values exported from Fusion-C Path Editor. Theses values are Relative Position from a Fixed Point. Compacted. See dertails in the documentation of the tool
static const char path1[]={0x03,0x03,0x03,0x03,0x03,0x20,0x03,0x03,0x20,0x03,0x03,0x20,0x03,0x03,0x20,0x03,0x20,0x03,0x23,0x25,0x20,0x03,0x20,0x03,0x20,0x03,0x20,0x23,0x20,0x23,0x20,0x03,0x20,0x03,0x20,0x23,0x20,0x23,0x20,0x23,0x20,0x23,0x23,0x23,0x20,0x03,0x20,0x03,0x20,0x23,0x20,0x03,0x20,0x23,0x23,0x03,0x20,0x03,0x20,0x03,0x20,0x03,0x20,0x03,0x23,0x03,0x20,0x03,0x20,0x03,0x23,0x03,0x23,0x03,0x23,0x03,0x23,0x03,0x20,0x03,0x03,0x23,0x03,0x03,0x03,0x23,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x33,0x03,0x03,0x30,0x03,0x33,0x03,0x03,0x30,0x03,0x30,0x03,0x30,0x03,0x30,0x33,0x33,0x30,0x03,0x30,0x30,0x03,0x30,0x30,0x30,0x03,
	0x00,0x30,0x30,0x30,0x30,0x33,0x30,0x30,0x30,0x02,0x30,0x30,0x30,0x30,0x02,0x30,0x30,0x32,0x30,0x30,0x02,0x30,0x02,0x30,0x02,0x02,0x30,0x02,0x04,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x20,0x02,0x02,0x20,0x02,0x20,0x02,0x22,0x02,0x20,0x02,0x20,0x02,0x22,0x02,0x20,0x02,0x20,0x02,0x22,0x02,0x20,0x02,0x22,0x02,0x22,0x22,0x02,0x22,0x22,0x02,0x22,0x02,0x20,0x02,0x20,0x02,0x02,0x20,0x02,0x22,0x02,0x20,0x02,0x02,0x20,0x02,0x22,0x02,0x02,0x22,0x02,0x20,0x02,0x02,0x02,0x20,0x02,0x02,0x02,0x02,0x20,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x30,0x02,0x02,0x32,0x02,0x02,0x32,0x02,0x02,0x30,0x02,
	0x00,0x32,0x32,0x02,0x30,0x02,0x30,0x32,0x30,0x02,0x30,0x30,0x02,0x30,0x30,0x32,0x30,0x30,0x30,0x30,0x02,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x03,0x30,0x30,0x30,0x03,0x30,0x30,0x03,0x33,0x30,0x03,0x03,0x30,0x33,0x03,0x30};



// Sprite Data as a 32 bytes pattern
static const  unsigned int pattern[]={
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111001110011,
						0b1111110000100001,
						0b1111110000100001,
						0b1111110000100001,
						0b1111110000100001,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b1111111111111111,
						0b0000000000000000
						};


// Wait for a Vsynch 
void FT_Wait(unsigned int cicles) {
  unsigned int i;

  for(i=0;i<cicles;i++) 
  {
      while(Vsynch()==0)
        {}
    }
}



void main (void)
{
	int max,n,k,o;
	sprite1.x=167;										// Sprites Start adress
	sprite1.y=47;

	sprite2.x=140;
	sprite2.y=100;

	n=0;
	o=200;
	k=1;
	max = sizeof(path1)/sizeof(path1[0]);				// Determine how many values inside the Path Table
	SetColors (15,7,1);
	Screen(2);
	Sprite16();
	SpriteSmall();

	SetSpritePattern(0,Sprite32Bytes(pattern),32);		// Set the pattern of the sprite

	
	  while(Inkey()!=27)								// Loop. presss ESC to stop and go back to Dos
	  {
	  		
	 		PutSprite(0,0,sprite1.x,sprite1.y,1);		// Put sprites
	 		PutSprite(1,0,sprite2.x,sprite2.y,5);
	 		
	 		sprite1.Data=path1[n];						// Put Path Value to sprite Data
	 		SpriteFollow(&sprite1);						// Decode the value and Set new x and y position inside the sprite structure

	 		sprite2.Data=path1[o];
	 		SpriteFollow(&sprite2);

	 		n=(n+1) % max;								// same as : n++;if (n>max);n=0;
	 		o=(o+1) % max;

	 		FT_Wait(100);								// Wait for 100 Vsynch
	 		
	 }

	 
	 Screen(0);
	 Exit(0);

}